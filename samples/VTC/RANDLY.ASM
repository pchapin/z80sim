USER	EQU	00H
DELAY	EQU	0FFDH
;
	ORG	1800H
; ***********************************************************
RANDOM:
;	This routine waits until the USER key is pressed and
;	then delays for a random interval in the range of 3
;	to 7 seconds. No registers are changed.
; ***********************************************************
	PUSH	AF		; Save registers.
	PUSH	BC
	PUSH	DE
	PUSH	HL
;
	; A random number is generated by incrementing a reg-
	; ister as fast as possible. By the time the user has
	; pressed the USER key, the register will have "wrapped"
	; around several times and its contents will be random.
;
TRYAGN:	IN	A,(USER)	; Is USER key pressed?
	BIT	6,A
	JP	Z,DODLY		; Yes... do random delay.
	INC	E		; Inc random number.
	JP	TRYAGN
;
DODLY:	LD	D,00H		; Make DE = 16 bit version of E.
	LD	B,4		; Multiply DE by 2^4.
SHIFT:	SLA	E
	RL	D
	DJNZ	SHIFT
	LD	HL,3000		; Delay no less than 3 Secs.
	ADD	HL,DE		; As long as 3+16*(.256) Secs.
	CALL	DELAY
;
	POP	HL		; Restore registers.
	POP	DE
	POP	BC
	POP	AF
	RET
;
	END
