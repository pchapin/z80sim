;=================================================
; EL214:      MICROPROCESSOR TECHNIQUES
; LAB5,6:     WASHER SKELETON PROGRAM
; PROGRAMMER: ASD/DBJ   MODIFIED
; DATE:       9/21/92
;=================================================

;THIS SKELETON PROGRAM SETS UP ONE POSSIBLE PLAN FOR THE WASHING
;MACHINE PROGRAM. WASHTIME AND WASHTEMP VALUES MAY CURRENTLY ONLY
;BE ADDED AFTER CLEAR HAS BEEN PRESSED OR UPON PROGRAM INITIATION.
;ADD SUB-ROUTINE DETAILS AND DECISION LOOPS AS YOU
;SEE FIT. STUDY THE OUTLINE BEFORE CHANGING EVERYTHING!


;DECLARATIONS
;LIBRARY SUBROUTINES
HL_DELAY: EQU 0FFDH     ;DELAY (HL x 1MILLISEC)
SCAN:     EQU 0FEEH     ;SINGLE PASS KEYPAD SCAN AND DISPLAY
KBRD:     EQU 0FEBH     ;SCAN AND DISPLAY, WAITS FOR KEYSTROKE
TONE:     EQU 0FFAH     ;TONE GENERATOR,DURATION=(HL X 1MILLISEC)


;RESERVED AREAS IN CAMI MEMORY

TG_FREQ:  EQU 1F49H     ;CONSTANT WHICH CONTROLS FREQ OF TONE GEN.
DIG_1:    EQU 1F1CH     ;PLACE 7 SEG CODE HERE BEFORE CALLING SCAN
DIG_2:    EQU 1F1DH
DIG_3:    EQU 1F1EH
DIG_4:    EQU 1F1FH     ;PLACE 7 SEG CODE HERE BEFORE CALLING SCAN
DIG_5:    EQU 1F20H
DIG_6:    EQU 1F21H


;PORTS
PORT_A:   EQU 0C0H      ;I/O PORTS ON LEFT SIDE OF CAMI
PORT_B:   EQU 0C1H
CTRLPORT: EQU 0C3H


;CONSTANTS USED IN THIS PROGRAM

;ADD OTHER CONSTANTS HERE AS NEEDS BE , USE THEIR NAMES IN LIEU OF VALUES
STRT_KEY: EQU 0FH       ;KEYCODE FOR "START" BUTTON FROM KBRD
COLD_KEY: EQU 08H       ;KEYCODE FOR "COLD" BUTTON FROM KBRD
WARM_KEY: EQU 09H       ;KEYCODE FOR "WARM" BUTTON FROM KBRD
HOT_KEY: EQU 0AH        ;KEYCODE FOR "HOT" BUTTON FROM KBRD
WT_1:   EQU     00H     ;KEYCODE FOR WASHTIME 3 MINS  FROM KBRD
WT_2:   EQU     01H     ;KEYCODE FOR WASHTIME 5 MINS  FROM KBRD
WT_3:   EQU     02H     ;KEYCODE FOR WASHTIME 7 MINS  FROM KBRD
WT_4:   EQU     03H     ;KEYCODE FOR WASHTIME 10 MINS FROM KBRD
CLRK_KEY:  EQU 0CH      ;KEYCODE FOR "CLEAR" BUTTON FROM KBRD

CLRS_KEY:  EQU 10H       ;KEYCODE FOR "CLEAR" BUTTON FROM SCAN
STP_KEY:  EQU 1CH       ;KEYCODE FOR "STOP" BUTTON FROM SCAN


;TABLES AND VARIABLES USED IN THIS PROGRAM
        ORG 1C00H
PROMPT:  DEFB 0,2,2,2,2,0       ;7 SEG CODES , 4 DASHES FOR PROMPT

;ADD OTHER TABLE VALUES HERE

;=================================================
;MAIN PROGRAM
        ORG 1800H
INITPORT:
        LD A,82H                ;INITIALIZE PORT_A AS OUTPUT,
        OUT (CTRLPORT),A        ;PORT_B AS INPUT

CLR_WASHER: LD HL,PROMPT        ;MOVE "PROMPT" DISPLAY TABLE TO APPROP. LOCN.
        LD DE,DIG_1
        LD BC,6
        LDIR
        CALL UPD_MSG
                               ;SET DEFAULT VALUES WASHTEMP / WASHTIME
                               ;KEEP IN MEMORY SOMEWHERE, SOMEPLACE
MAIN_DISPLAY:
        CALL KBRD               ;DISPLAYS MESSAGE AND SCANS KEYPAD

        CP CLRK_KEY              ;IS IT THE "CLEAR" BUTTON?
        JP Z,CLR_WASHER         ;CLEARS TO DEFAULT SETTINGS, BACK TO BEGINNING


        CP WT_1                    ;CHECK THE TIMER BUTTONS
        JP Z, WTSETUP
        CP WT_2                    ;CHECK THE TIMER BUTTONS
        JP Z, WTSETUP
        CP WT_3                    ;CHECK THE TIMER BUTTONS
        JP Z, WTSETUP
        CP WT_4                    ;CHECK THE TIMER BUTTONS
        JP Z, WTSETUP


        CP COLD_KEY
        JP Z,WAT_TEMP          ;WATER TEMP STORE AND DISPLAY.
        CP WARM_KEY
        JP Z,WAT_TEMP
        CP HOT_KEY
        ;  (CHECK THE OTHER SET-UP KEYCODES HERE IF ANY)

        CP STRT_KEY
        JP Z, START_FILL
        JP MAIN_DISPLAY         ;NOT LEGAL KEY, GOTO TOP OF LOOP
;-----------------------------------
WAT_TEMP:       ;DO SOMETHING HERE TO REMEMBER WATER TEMP AND DISPLAY!

        JP MAIN_DISPLAY

WTSETUP:        ;DO SOMETHING HERE TO REMEMBER WASHTIME VALUE / TEMP DISPLAY!

        JP MAIN_DISPLAY

START_FILL:             ;THE MAIN SEQUENCER TIMING SOFTWARE
        CALL FILL
        CALL AGITATE
        CALL DRAIN
        CALL FILL
        CALL AGITATE
        CALL DRAIN
        CALL SPIN
        CALL END_DISPLAY        ;DONE MESSAGE THEN BACK TO PROMPT


        JP MAIN_DISPLAY

        ;SUBROUTINES LISTED BELOW HERE
        ;DETAILS NEED TO BE ADDED!

FILL:            RET
AGITATE:         RET
DRAIN:           RET
SPIN:            RET
END_DISPLAY:     RET

UPD_MSG:              ;TAKE APPROP CYCLE TABLE CONTENTS
                      ;AND CREATE NEW MESSAGE

          RET

          END
